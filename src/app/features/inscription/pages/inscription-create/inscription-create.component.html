<div class="inscription-container">
  <!-- Formulaire d'inscription -->
  <div>
    <form id="inscription_form" [formGroup]="inscriptionCreationForm" (ngSubmit)="handleInscription()">
      <label for="stageType">Type de Stage</label>
      <select id="stageType" formControlName="stageType">
        <option value="" disabled selected>Sélectionner un type de stage</option>
        <option *ngFor="let type of stageTypes" [value]="type.value">
          {{ type.label }}
        </option>
      </select>

      <label for="codePromo">Code promo (optionnel)</label>
      <input id="codePromo" formControlName="codePromo" placeholder="Code Promo (optionnel)" />


      <!-- Permis -->
      <label for="permis"><strong>Permis :</strong></label>
      <p-fileUpload
        name="permis"
        [customUpload]="true"
        (uploadHandler)="uploadFiles($event)"
        (onSelect)="onFilesChange($event, 'permis')"
        (onRemove)="onRemoveFile($event, 'permis')"
        [multiple]="true"
        [showUploadButton]="false"
        [showCancelButton]="false"
        accept=".pdf,image/*"
        chooseLabel="Choisir le fichier"
        mode="advanced"
        [maxFileSize]="5000000"
      ></p-fileUpload>

      <!-- Carte d'identité -->
      <label for="carteId"><strong>Carte d'identité :</strong></label>
      <p-fileUpload
        name="carteId"
        [customUpload]="true"
        (uploadHandler)="uploadFiles($event)"
        (onSelect)="onFilesChange($event, 'carteId')"
        (onRemove)="onRemoveFile($event, 'carteId')"
        [multiple]="true"
        [showUploadButton]="false"
        [showCancelButton]="false"
        accept=".pdf,image/*"
        chooseLabel="Choisir le fichier"
        mode="advanced"
        [maxFileSize]="5000000"
      ></p-fileUpload>
      <!--<div *ngIf="uploadedFiles.permis.length > 0">
        <ul>
          <li *ngFor="let file of uploadedFiles.permis; let i = index">
            {{ file.name }}
            <button type="button" (click)="removeManualFile('permis', i)">❌</button>
          </li>
        </ul>
      </div>-->

      <!-- Lettre 48N -->
      <div *ngIf="selectedStageLabel === 'Tribunal'">
        <label for="lettre48n"><strong>Lettre 48N :</strong></label>
        <p-fileUpload
          name="lettre48n"
          [customUpload]="true"
          (uploadHandler)="uploadFiles($event)"
          (onSelect)="onFilesChange($event, 'lettre48n')"
          (onRemove)="onRemoveFile($event, 'lettre48n')"
          [multiple]="true"
          [showUploadButton]="false"
          [showCancelButton]="false"
          accept=".pdf,image/*"
          chooseLabel="Choisir le fichier"
          mode="advanced"
          [maxFileSize]="5000000"
        ></p-fileUpload>

      </div>
      <br>
      <div *ngIf="lettre48nError" class="error-message">
        {{ lettre48nError }}
      </div>

      <button type="submit" [disabled]="inscriptionCreationForm.invalid || isLoading" class="submit-button">
        <ng-container *ngIf="isLoading">
          <span class="spinner-inline"></span>
          <span>Chargement...</span>
        </ng-container>
        <ng-container *ngIf="!isLoading">
          Valider l'inscription
        </ng-container>
      </button>
    </form>

  </div>


  <!-- Détails du stage -->
  <div class="stage-details" *ngIf="stageDetails">
    <div style="text-align: left; width:60%;margin:0 auto;padding:20px;">
      <h2>Stage à {{ stageDetails.city }}</h2>
      <br>
      <p>🧭   {{ stageDetails.street }}</p> <p>{{ stageDetails.arrondissement }} arrondissement</p>
      <p>📆   {{ stageDetails.dateDebut | date:'d':'fr' }} & {{ stageDetails.dateFin | date:'d MMMM yyyy':'fr' }}</p>
      <p>Prix: {{ stageDetails.price }}€</p>
    </div>
    <div class="consignes_container">
      <h3><span style="font-size: 2em;">⚠️</span> Consignes à respecter !</h3>
        <ul>
          <h4>-> Permis de permis conduire:</h4>
          <li>
            recto: "(nom_prénom)_permis_recto"
          </li>
          <li>
            verso: "(nom_prénom)_permis_verso"
          </li>
      </ul>
      <ul>
        <br/>
        <h4>-> Papiers d'identité:</h4>
       <li> recto: "(nom_prénom)_identité_recto"
       </li>
        <li>verso: "(nom_prénom)_identité_verso"</li>
      </ul>
      <br>
      <div class="form-text text-muted">
        <ul>
          <li>Formats acceptés pour les images : JPEG, PNG.</li>
          <li>La lettre 48N doit être en PDF.</li>
        </ul>
      </div>
    </div>
    <br/>
  </div>
</div>
