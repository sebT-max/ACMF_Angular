<div class="inscription-container">
  <!-- Détails du stage -->
  <div id="inscription_container_details" class="stage-details" *ngIf="stageDetails">
    <div class="details-wrapper">
      <h2>Stage à {{ stageDetails.city }}</h2>
      <p><strong>Numéro de stage:</strong> {{ stageDetails.number }}</p>
      <p><strong>{{ stageDetails.street }}</strong></p>
      <p><strong>{{ stageDetails.dateDebut | date:'d':'fr' }} & {{ stageDetails.dateFin | date:'d MMMM yyyy':'fr' }}</strong></p>
      <p><strong>Prix :</strong> {{ stageDetails.price }}€</p>
    </div>

    <div class="consignes_container">
      <h3><span class="icon">⚠️</span> <strong> Consignes à respecter !</strong></h3>
      <div class="form-text text-muted format">
        <ul>
          <li>Formats acceptés : JPEG, PNG, PDF</li>
        </ul>
      </div>

      <h4>Nom des fichiers attendus :</h4>
      <ul>
        <li><strong>Permis ou Avis de suspension :</strong></li>
        <ul>
          <li>Recto : <code>(nom_prénom)_permis_recto</code></li>
          <li>Verso : <code>(nom_prénom)_permis_verso</code></li>
          <li>Verso : <code>(nom_prénom)_avis_suspension</code></li>
        </ul>
        <li><strong>Carte d'identité :</strong></li>
        <ul>
          <li>Recto : <code>(nom_prénom)_identité_recto</code></li>
          <li>Verso : <code>(nom_prénom)_identité_verso</code></li>
        </ul>
      </ul>
    </div>
  </div>

  <!-- Formulaire -->
  <div id="inscription_container_form">
    <form id="inscription_form" [formGroup]="inscriptionCreationForm" (ngSubmit)="handleInscription()">
      <div formGroupName="user">
        <!-- Informations personnelles -->
        <section class="form-section">
          <h3>Informations personnelles</h3>

          <!-- <label for="firstName">Prénom*</label> -->
          <input id="firstName" formControlName="firstName" type="text" placeholder="Prénom" />

          <!-- <label for="lastName">Nom*</label> -->
          <input id="lastName" formControlName="lastName" type="text" placeholder="Nom" />

          <!-- <label for="lastName">Nom*</label> -->
          <input id="otherNames" formControlName="otherNames" type="text" placeholder="Autres noms" />

          <!-- <label for="birthdate">Autre(s) prénom(s)</label> -->
<!--
          <input id="birthdate" formControlName="birthdate" type="date" placeholder="Date de naissance" />
-->
          <p-datepicker
            [showIcon]="false"
            [showButtonBar]="true"
            [readonlyInput]="true"
            dateFormat="dd/mm/yy"
            id="birthdate"
            formControlName="birthdate"
            placeholder="Date de naissance"
          ></p-datepicker>
          <!-- <label for="birthplace">Lieu de naissance*</label> -->
          <input id="birthplace" formControlName="birthplace" type="text" placeholder="Lieu de naissance" />
        </section>

        <!-- Adresse -->
        <section class="form-section">
          <h3>Adresse</h3>

          <!-- <label for="streetAndNumber">Rue et numéro*</label> -->
          <input id="streetAndNumber" formControlName="streetAndNumber" type="text" placeholder="Rue et numéro" />

          <!-- <label for="zipCode">Code Postal*</label> -->
          <input id="zipCode" formControlName="zipCode" type="number" placeholder="Code postal" />

          <!-- <label for="city">Ville*</label> -->
          <input id="city" formControlName="city" type="text" placeholder="Ville" />
        </section>

        <!-- Contact -->
        <section class="form-section">
          <h3>Contact</h3>

          <!-- <label for="telephone">Téléphone*</label> -->
          <input id="telephone" formControlName="telephone" type="tel" placeholder="Téléphone" />

          <!-- <label for="email">Email*</label> -->
          <input id="email" formControlName="email" type="email" placeholder="Email" />
        </section>

        <!-- Mot de passe -->
        <section class="form-section">
          <!-- <label for="password">Mot de passe*</label> -->
          <input id="password" type="password" placeholder="Mot de passe (accès à votre espace client)" formControlName="password" />
          <div *ngIf="inscriptionCreationForm.get('password')?.invalid && inscriptionCreationForm.get('password')?.touched" class="error-message">
            <span *ngIf="inscriptionCreationForm.get('password')?.errors?.['required']">Le mot de passe est requis.</span>
            <span *ngIf="inscriptionCreationForm.get('password')?.errors?.['minlength']">Minimum 6 caractères.</span>
          </div>
        </section>
      </div>
      <!-- Type de stage -->
      <section class="form-section">
        <!-- <label for="stageType">Type de Stage*</label> -->
        <select id="stageType" formControlName="stageType">
          <option value="" disabled selected>Sélectionner un type de stage</option>
          <option *ngFor="let type of stageTypes" [value]="type.value">
            {{ type.label }}
          </option>
        </select>
      </section>

      <!-- Fichiers -->
      <section id="inscription_form_files" class="form-section">
        <h3>Documents à fournir</h3>

        <div class="file-upload-section">
          <!-- <label for="permis"><strong>Permis ou Avis de suspension</strong></label> -->
          <p-fileUpload
            name="Permis de conduire"
            [customUpload]="true"
            (uploadHandler)="uploadFiles($event)"
            (onSelect)="onFilesChange($event, 'permis')"
            (onRemove)="onRemoveFile($event, 'permis')"
            [multiple]="true"
            [showUploadButton]="false"
            [showCancelButton]="false"
            accept=".pdf,image/*"
            chooseLabel=" Permis de conduire"
            mode="advanced"
            [maxFileSize]="5000000"
            id="driving_license"
          ></p-fileUpload>
        </div>

        <div class="file-upload-section">
          <!-- <label for="carteId"><strong>Carte d'identité</strong></label> -->
          <p-fileUpload
            name="Carte d'identité"
            [customUpload]="true"
            (uploadHandler)="uploadFiles($event)"
            (onSelect)="onFilesChange($event, 'carteId')"
            (onRemove)="onRemoveFile($event, 'carteId')"
            [multiple]="true"
            [showUploadButton]="false"
            [showCancelButton]="false"
            accept=".pdf,image/*"
            chooseLabel=" Carte d'identité"
            mode="advanced"
            [maxFileSize]="5000000"
            id="carteId"
          ></p-fileUpload>
        </div>

        <div *ngIf="selectedStageLabel === 'Stage obligatoire permis probatoire'" class="file-upload-section">
          <!-- <label for="lettre48n"><strong>Lettre 48N</strong></label> -->
          <p-fileUpload
            name="lettre48n"
            [customUpload]="true"
            (uploadHandler)="uploadFiles($event)"
            (onSelect)="onFilesChange($event, 'lettre48n')"
            (onRemove)="onRemoveFile($event, 'lettre48n')"
            [multiple]="true"
            [showUploadButton]="false"
            [showCancelButton]="false"
            accept=".pdf,image/*"
            chooseLabel=" Lettre 48N"
            mode="advanced"
            [maxFileSize]="5000000"
            id="lettre48n"
          ></p-fileUpload>
        </div>
        <div *ngIf="selectedStageLabel === 'Stage obligatoire imposé par le tribunal'" class="file-upload-section">
          <!-- <label for="décision de justice"><strong>Décision de justice</strong></label> -->
          <p-fileUpload
            name="Décision de justice"
            [customUpload]="true"
            (uploadHandler)="uploadFiles($event)"
            (onSelect)="onFilesChange($event, 'decisionJustice')"
            (onRemove)="onRemoveFile($event, 'décision de justice')"
            [multiple]="true"
            [showUploadButton]="false"
            [showCancelButton]="false"
            accept=".pdf,image/*"
            chooseLabel=" Décision de justice"
            mode="advanced"
            [maxFileSize]="5000000"
            id="court_letter"
          ></p-fileUpload>
        </div>
      </section>

      <!-- Code promo -->
      <section class="form-section">
        <!-- <label for="codePromo">Code Promo (optionnel)</label> -->
        <input id="codePromo" formControlName="codePromo" placeholder="Code Promo" />
      </section>

      <!-- Erreurs -->
      <div *ngIf="lettre48nError" class="error-message">
        {{ lettre48nError }}
      </div>

      <!-- Soumission -->
      <div class="submit-wrapper">
        <button type="submit" [disabled]="inscriptionCreationForm.invalid || isLoading" class="submit-button">
          <ng-container *ngIf="isLoading">
            <span class="spinner-inline"></span> Chargement...
          </ng-container>
          <ng-container *ngIf="!isLoading">
            Valider l'inscription
          </ng-container>
        </button>
      </div>

    </form>
  </div>
</div>
